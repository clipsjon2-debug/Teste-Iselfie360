<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Or√ßamento | iSelfie360</title>
<style>
:root { --cor-principal: #FFA500; --cor-hover: #FFD700; --cor-fundo: #ece5dd; --cor-whatsapp: #25D366; }
html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: var(--cor-fundo); font-family: 'Segoe UI', Arial, sans-serif; }
.app-container { width: 100%; max-width: 500px; height: 100%; margin: 0 auto; background: #efeae2; display: flex; flex-direction: column; }
.header { background: var(--cor-principal); color: #fff; padding: 15px; text-align: center; font-weight: bold; font-size: 18px; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
#chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; scroll-behavior: smooth; }
.bot, .user { max-width: 85%; padding: 12px 16px; border-radius: 15px; margin: 8px 0; line-height: 1.5; font-size: 15px; word-wrap: break-word; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
.bot { background: #fff; align-self: flex-start; border-bottom-left-radius: 2px; }
.user { background: #dcf8c6; align-self: flex-end; text-align: right; border-bottom-right-radius: 2px; }
button { width: 100%; padding: 15px; margin-top: 10px; background: var(--cor-principal); color: #fff; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 16px; display: block; }
button:hover { background: var(--cor-hover); }
.grid-botoes { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
.grid-botoes button { padding: 10px; font-size: 14px; margin-top: 0; }
.whatsapp { background: var(--cor-whatsapp); margin-top: 20px; font-size: 18px; }
input { width: 100%; padding: 15px; margin-top: 10px; border-radius: 12px; border: 2px solid #ddd; font-size: 16px; box-sizing: border-box; outline: none; }
.pac-container { z-index: 9999 !important; border-radius: 10px; }
.aviso-legal { font-size: 12px; color: #666; margin-top: 10px; display: block; line-height: 1.2; }
</style>
</head>
<body>
<div class="app-container">
    <div class="header">üì∏ iSelfie360</div>
    <div id="chat"></div>
</div>
<script>
const chatDiv = document.getElementById("chat");
const ORIGEM = "85851-020"; // CEP de Foz do Igua√ßu
const VALOR_KM = 2.5;
let dados = { nome: "", telefone: "", servico: "", local: "", convidados: 0, tipoEvento: "", dataEvento: "", km: 0, valorKm: 0, freteGratis: false, adicionais: [] };

const precosBase = { 
    "T√∫nel Infinity": 2790, "Espelho M√°gico": 1890, "Cabine Personalizada": 2090, "Cabine de Fotos": 1990, 
    "Selfie Totem": 1550, "Plataforma 360": 1290, "Totem de Fotos": 1600, "Totem Personalizado": 1750 
};
const precosAdicionais = { "Livro de assinaturas": 450, "Telefone de mensagens": 800 };
const tiposDeEvento = ["Casamento", "15 anos (Debutante)", "Anivers√°rio", "Anivers√°rio Infantil", "Corporativo", "Formatura", "Outros"];

function maskTel(v) {
    v = v.replace(/\D/g, "");
    v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
    v = v.replace(/(\d)(\d{4})$/, "$1-$2");
    return v;
}

function bot(t) { const d = document.createElement("div"); d.className = "bot"; d.innerHTML = t; chatDiv.appendChild(d); chatDiv.scrollTop = chatDiv.scrollHeight; }
function user(t) { const d = document.createElement("div"); d.className = "user"; d.innerHTML = t; chatDiv.appendChild(d); chatDiv.scrollTop = chatDiv.scrollHeight; }

function iniciarChat() {
    bot("Ol√°! üòä Bem-vindo √† iSelfie360. Qual o seu <b>nome</b>?");
    const input = document.createElement("input"); input.placeholder = "Seu nome";
    const btn = document.createElement("button"); btn.innerText = "Pr√≥ximo";
    const div = document.createElement("div"); div.append(input, btn); chatDiv.appendChild(div);
    btn.onclick = () => { if (input.value.length > 2) { dados.nome = input.value.toUpperCase(); user(dados.nome); div.remove(); pedirTelefone(); } };
}

function pedirTelefone() {
    bot(`Prazer, ${dados.nome}! Informe seu <b>WhatsApp</b>:`);
    const input = document.createElement("input"); 
    input.type = "tel"; input.placeholder = "(00) 00000-0000"; input.maxLength = 15;
    input.onkeyup = (e) => { e.target.value = maskTel(e.target.value); };
    const btn = document.createElement("button"); btn.innerText = "Ver Equipamentos";
    const div = document.createElement("div"); div.append(input, btn); chatDiv.appendChild(div);
    btn.onclick = () => { 
        const telLimpo = input.value.replace(/\D/g, "");
        if (telLimpo.length >= 10) { dados.telefone = input.value; user(dados.telefone); div.remove(); selecionarEquipamento(); } 
        else { alert("Por favor, digite o n√∫mero completo com DDD."); }
    };
}

function selecionarEquipamento() {
    bot("Qual <b>equipamento</b> voc√™ deseja?");
    Object.keys(precosBase).forEach(s => { const b = document.createElement("button"); b.innerText = s; b.onclick = () => { dados.servico = s; user(s); limparBotoes(); pedirEndereco(); }; chatDiv.appendChild(b); });
}

function pedirEndereco() {
    bot("Onde ser√° o evento? üìç");
    const input = document.createElement("input"); input.placeholder = "Rua, Buffet ou Cidade..."; chatDiv.appendChild(input);
    const autocomplete = new google.maps.places.Autocomplete(input, { types: ['geocode', 'establishment'], fields: ['formatted_address'], componentRestrictions: { country: "br" } });
    autocomplete.addListener("place_changed", () => { const place = autocomplete.getPlace(); if (place && place.formatted_address) { dados.local = place.formatted_address; input.disabled = true; user(dados.local); calcularDistancia(); } });
}

function calcularDistancia() {
    bot("Calculando deslocamento... üöó");
    const service = new google.maps.DistanceMatrixService();
    service.getDistanceMatrix({ origins: [ORIGEM], destinations: [dados.local], travelMode: "DRIVING" }, (res, status) => {
        if (status === "OK" && res.rows[0].elements[0].status === "OK") {
            const metros = res.rows[0].elements[0].distance.value;
            dados.km = (metros / 1000).toFixed(1);
            let multiplicador = dados.km > 100 ? 2 : 1;
            let frete = (dados.km * VALOR_KM) * multiplicador;
            if (frete < 100) { dados.valorKm = 0; dados.freteGratis = true; bot("üéÅ Voc√™ GANHOU <b>FRETE GR√ÅTIS!</b>"); }
            else { dados.valorKm = frete.toFixed(2); bot(`Dist√¢ncia: ${dados.km}km.`); }
            bot("Quantos <b>convidados</b>?");
            const input = document.createElement("input"); input.type = "number"; const btn = document.createElement("button"); btn.innerText = "Pr√≥ximo";
            const div = document.createElement("div"); div.append(input, btn); chatDiv.appendChild(div);
            btn.onclick = () => { if (input.value > 0) { dados.convidados = parseInt(input.value); user(dados.convidados + " convidados"); div.remove(); perguntarTipoEvento(); } };
        }
    });
}

function perguntarTipoEvento() {
    bot("Qual o <b>tipo de evento</b>?");
    const grid = document.createElement("div"); grid.className = "grid-botoes";
    tiposDeEvento.forEach(tipo => { const b = document.createElement("button"); b.innerText = tipo; b.onclick = () => { dados.tipoEvento = tipo; user(tipo); grid.remove(); pedirData(); }; grid.appendChild(b); });
    chatDiv.appendChild(grid);
}

function pedirData() {
    bot("Qual a <b>data</b>?");
    const input = document.createElement("input"); input.type = "date"; const btn = document.createElement("button"); btn.innerText = "Pr√≥ximo";
    const div = document.createElement("div"); div.append(input, btn); chatDiv.appendChild(div);
    btn.onclick = () => { if (input.value) { const d = input.value.split('-'); dados.dataEvento = `${d[2]}/${d[1]}/${d[0]}`; user(dados.dataEvento); div.remove(); pedirAdicionais(); } };
}

function pedirAdicionais() {
    bot("Deseja algum <b>adicional</b>?");
    const div = document.createElement("div");
    Object.keys(precosAdicionais).forEach(item => {
        if (!dados.adicionais.includes(item)) {
            const b = document.createElement("button"); 
            b.innerText = `+ ${item} (R$ ${precosAdicionais[item]})`;
            b.onclick = () => { dados.adicionais.push(item); user(item); div.remove(); pedirAdicionais(); };
            div.appendChild(b);
        }
    });
    const btnFinal = document.createElement("button"); btnFinal.innerText = "‚úÖ Finalizar Or√ßamento"; btnFinal.style.background = "#444";
    btnFinal.onclick = () => { div.remove(); finalizar(); };
    div.appendChild(btnFinal); chatDiv.appendChild(div);
}

function finalizar() {
    let valorEquip = precosBase[dados.servico];
    if (dados.tipoEvento === "15 anos (Debutante)" || dados.tipoEvento === "Anivers√°rio") valorEquip -= 150;
    else if (dados.tipoEvento === "Anivers√°rio Infantil") valorEquip -= 200;
    else if (dados.tipoEvento === "Corporativo") valorEquip += 400;

    let taxaConvidados = 0;
    if (dados.convidados > 400) taxaConvidados = 200;
    else if (dados.convidados > 300) taxaConvidados = 150;
    else if (dados.convidados > 200) taxaConvidados = 100;

    let valorAdd = 0;
    dados.adicionais.forEach(i => valorAdd += precosAdicionais[i]);
    const total = valorEquip + valorAdd + taxaConvidados + Number(dados.valorKm);

    let linhaFrete = dados.freteGratis ? `üöó Frete: üéÅ <b>GR√ÅTIS</b><br>` : "";
    bot(`üí∞ <b>OR√áAMENTO FINAL</b><br><br>üë§ ${dados.nome}<br>üì∏ ${dados.servico}<br>üé≠ ${dados.tipoEvento}<br>üìÖ ${dados.dataEvento}<br>üìç ${dados.local}<br>üë• ${dados.convidados} convidados<br>${linhaFrete}${taxaConvidados > 0 ? `üë• Taxa Convidados: R$ ${taxaConvidados.toFixed(2)}<br>` : ""}üì¶ Adicionais: ${dados.adicionais.join(", ") || "Nenhum"}<br><br><span style="font-size:22px;"><b>TOTAL: R$ ${total.toFixed(2)}</b></span><br><span class="aviso-legal">*Os valores e disponibilidade podem sofrer altera√ß√µes sem aviso pr√©vio.</span><br><button class="whatsapp" onclick="whats(${total})">üí¨ RESERVAR NO WHATSAPP</button>`);
}

function limparBotoes() { const btns = chatDiv.querySelectorAll("button"); btns.forEach(b => { if (!b.classList.contains("whatsapp")) b.style.display = "none" }); }

function whats(v) {
    const adds = dados.adicionais.join(", ") || "Nenhum";
    const textoMensagem = `‚≠ê *NOVO OR√áAMENTO* ‚≠ê\n\n` +
                          `-------------------------------\n` +
                          `üë§ *Cliente:* ${dados.nome}\n` +
                          `üì± *WhatsApp:* ${dados.telefone}\n` +
                          `üìÖ *Data:* ${dados.dataEvento}\n` +
                          `üìç *Local:* ${dados.local}\n` +
                          `üì∏ *Modelo:* ${dados.servico}\n` +
                          `üë• *Convidados:* ${dados.convidados}\n` +
                          `üé≠ *Tipo:* ${dados.tipoEvento}\n` +
                          `üì¶ *Adicionais:* ${adds}\n` +
                          `üöó *Frete:* ${dados.freteGratis ? "Gr√°tis" : "R$ " + dados.valorKm}\n` +
                          `-------------------------------\n` +
                          `üí∞ *VALOR TOTAL: R$ ${v.toFixed(2)}*\n` +
                          `-------------------------------`;

    const msgEncoded = encodeURIComponent(textoMensagem);
    window.open(`https://wa.me/554599496623?text=${msgEncoded}`, '_blank');
}
function initAddress() { iniciarChat(); }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBeZJBQmfgsfUhmMPazIU03mViwLscowIg&libraries=places&callback=initAddress" async defer></script>
</body>
</html>